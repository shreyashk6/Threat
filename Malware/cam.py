import cv2
import time

def open_camera(interval=5):
    """Opens the camera, displays the feed, and takes pictures automatically."""

    cap = cv2.VideoCapture(0)

    if not cap.isOpened():
        print("Error: Could not open camera.")
        return

    #cv2.namedWindow("Camera Feed")
    picture_count = 0
    last_capture_time = time.time()
    timeout = 10  #TIMER 
    start_time=time.time()

    while True:
        ret, frame = cap.read()
        end_time = time.time()
        final_time = end_time - start_time

        if not ret:
            print("Error: Could not read frame.")
            break

        #cv2.imshow("Camera Feed", frame)  #COMMENT TO HIDE CAMERA

        current_time = time.time()

        # Check for capture *without* blocking using time.perf_counter()
        elapsed_time = current_time - last_capture_time

        if elapsed_time >= interval:
            picture_count += 1
            filename = f"picture_{picture_count}_{time.strftime('%Y%m%d%H%M%S')}.jpg"
            cv2.imwrite(filename, frame)
            print(f"Picture saved as {filename}")
            last_capture_time = current_time  # Reset the timer

        #key = cv2.waitKey(1)  # Still needed for window updates and 'q' to quit
        
        if (final_time >= timeout):
            print("Timeout reached. Exiting...")
            break

    cap.release()
    cv2.destroyAllWindows()


if __name__ == "__main__":
    open_camera(interval=1)  # Example: 2-second interval
    